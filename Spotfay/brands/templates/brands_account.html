{% extends 'brands_base.html' %}
{% load static %}
{% block title %}account{% endblock %}
{% block page_content %}

{% if messages %}
  {% for message in messages %}
    <div class="modal" dir="" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded rounded-4 shadow-lg">
        <div class="modal-header border-0">
          <h1 class="modal-title fs-5 ms-4">
            Error!
          </h1>
        </div>
          <div class="modal-body border-0 ms-5">
            {{message}}
          </div>
          <div class="modal-footer border-0">
            <button type="button" id="btn-closee" style="background-color: #4A0EFB;" class="btn rounded-pill text-light w-100">Close</button>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}


    <!-- content -->
    <div class="col-12 col-sm-11 mt-3 mt-sm-5 mx-auto p-0">
        <div class="d-block d-sm-flex align-items-start">
          <ul class="nav nav-underline mb-5 d-flex d-sm-none justify-content-between col-11 m-auto" style="border-bottom: 1px solid rgb(200, 200, 201);" id="underline-tab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link text-muted active d-flex align-items-center fw-light" style="font-size: 18px;font-variation-settings: 'FILL' 1;" id="account-tab" data-bs-toggle="pill" data-bs-target="#v-pills-account" type="button" role="tab" aria-controls="underline-account" aria-selected="true"><span class="material-symbols-outlined">person</span>Account</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link text-muted d-flex align-items-center fw-light" style="font-size: 18px;font-variation-settings: 'FILL' 1;" id="wallet-tab" data-bs-toggle="pill" data-bs-target="#v-pills-wallet" type="button" role="tab" aria-controls="underline-wallet" aria-selected="true"><span class="material-symbols-outlined">wallet</span>Wallet</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link text-muted d-flex align-items-center gap-1 fw-light" style="font-size: 18px;font-variation-settings: 'FILL' 1;" id="orders-tab" data-bs-toggle="pill" data-bs-target="#v-pills-orders" type="button" role="tab" aria-controls="underline-orders" aria-selected="false"><span class="material-symbols-outlined">list</span>Orders</button>
            </li>
          </ul>    

            <div class="nav flex-column d-none d-sm-block nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
              <button class="nav-link text-secondary active d-flex align-items-center gap-2" style="font-variation-settings: 'FILL' 1;" id="account-tab" data-bs-toggle="pill" data-bs-target="#v-pills-account" type="button" role="tab" aria-controls="v-pills-account" aria-selected="true"><span class="material-symbols-outlined">person</span>Account</button>
              <button class="nav-link text-secondary d-flex align-items-center gap-2" style="font-variation-settings: 'FILL' 1;" id="wallet-tab" data-bs-toggle="pill" data-bs-target="#v-pills-wallet" type="button" role="tab" aria-controls="v-pills-wallet" aria-selected="false"><span class="material-symbols-outlined">wallet</span>Wallet</button>
              <button class="nav-link text-secondary d-flex align-items-center gap-2" style="font-variation-settings: 'FILL' 1;" id="orders-tab" data-bs-toggle="pill" data-bs-target="#v-pills-orders" type="button" role="tab" aria-controls="v-pills-orders" aria-selected="false"><span class="material-symbols-outlined">list</span>Orders</button>
            </div>
            <div class="tab-content w-100" id="v-pills-tabContent">
                <!-- Account -->
                <div class="tab-pane col-12 col-md-11 fade mb-5 show active" id="v-pills-account" role="tabpanel" aria-labelledby="account-tab" tabindex="0">
                  <!-- desktop view -->
                  <div class="bg-white rounded d-none d-sm-block rounded-1 shadow-sm px-4 px-md-5 pt-4 w-100 pb-5">
                    <h5 class="ms-3">Profile information</h5>
                    <!-- Profile Information Section -->
                    <div class="p-4 mt-4 shadow-sm" id="profile-info">
                      <div class="d-sm-flex justify-content-between">
                          <div class="col-11 col-md-9">
                              <div class="d-flex align-items-center">
                                  <div class="col-6 col-md-7 col-lg-5 col-xl-4">
                                      <h6>First name</h6>
                                      <span class="text-secondary fs-6">{{user.first_name|default_if_none:""}}</span>
                                  </div>
                                  <div>
                                      <h6>Last name</h6>
                                      <span class="text-secondary fs-6">{{user.last_name|default_if_none:""}}</span>
                                  </div>
                              </div>
                              <div class="d-flex align-items-center mt-5">
                                  <div class="col-6 col-md-7 col-lg-5 col-xl-4">
                                      <h6>Country</h6>
                                      <span class="text-secondary fs-6">{{userinfos.country|default_if_none:""}}</span>
                                  </div>
                                  <div>
                                      <h6>Mobile number</h6>
                                      <span class="text-secondary fs-6">{{userinfos.phonenum|default_if_none:""}}</span>
                                  </div>
                              </div>

                          </div>
                          <button class="text-muted edit-btn p-0 m-0 bg-transparent border-0 h-25" onclick="toggleEdit('profile-info', 'profile-edit', this)"><span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span></button>
                      </div>
                    </div>
                    <!-- Edit Profile Information Section -->
                     <div class="p-4 mt-4 shadow d-none" id="profile-edit">
                      <form method="POST" class="d-flex justify-content-between" id="profile-edit">
                        {% csrf_token %}
                        <div class="col-md-12">
                            <input type="hidden" name="form_type" value="profile_information">
                            <div class="d-flex justify-content-evenly align-items-center">
                                <div class="col-5">
                                    <h6>First name</h6>
                                    <input type="text" name="first_name" id="" class="form-control" style="background-color: rgb(238	240	244);" value="{{user.first_name|default_if_none:""}}">
                                </div>
                                <div class="col-5">
                                    <h6>Last name</h6>
                                    <input type="text" name="last_name" id="" class="form-control" style="background-color: rgb(238	240	244);" value="{{user.last_name|default_if_none:""}}">
                                </div>
                            </div>
                            <div class="d-flex mt-5 mb-4 justify-content-evenly align-items-center">
                                <div class="col-5">
                                    <h6>Country</h6>
                                    <input type="text" name="country" id="" class="form-control" style="background-color: rgb(238	240	244);" value="{{userinfos.country|default_if_none:""}}">
                                </div>
                                <div class="col-5">
                                    <h6>Mobile number</h6>
                                    <input type="number" name="phonenum" id="" class="form-control" style="background-color: rgb(238	240	244);" value="{{userinfos.phonenum|default_if_none:""}}">
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-1 col-11 mx-auto">
                                <button type="button" class="btn bg-transparent px-md-4 px-lg-5 border rounded rounded-pill border-1" onclick="toggleEdit('profile-info', 'profile-edit')">Cancel</button>
                                <button type="submit" class="btn btn-primary px-md-4 px-lg-5 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                            </div>
                        </div>
                      </form>
                    </div>
                    <!-- Email Section -->
                    <div class="p-4 shadow-sm mt-4" id="email-info">
                        <div class="d-flex align-items-center mb-4 justify-content-between">
                            <h6>Email</h6>
                            <button class="text-muted edit-btn p-0 m-0 edit-btn bg-transparent border-0 h-25" onclick="toggleEdit('email-info', 'email-edit')"><span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span></button>
                        </div>
                        <a href="mailto:user@gmail.com" class="fs-6 text-secondary">{{user.email}}</a>
                    </div>
                    <!-- Edit Email Section -->
                    <form method="POST" class="p-4 shadow mt-4 d-none" id="email-edit">
                        {% csrf_token %}
                      <div class="d-flex align-items-center mb-4 justify-content-between">
                          <h6>Email</h6>
                      </div>
                      <input type="hidden" name="form_type" value="email">
                      <input type="email" name="email" id="" class="form-control w-50" value="{{user.email|default_if_none:""}}" style="background-color: rgb(238	240	244);">
                      <div class="d-flex align-items-center gap-1 col-12 mt-5 mx-auto">
                          <button type="button" class="btn bg-transparent fs-6 px-md-4 px-lg-5 border rounded rounded-pill border-1" onclick="toggleEdit('email-info', 'email-edit', this)">Cancel</button>
                          <button type="submit" class="btn btn-primary fs-6 px-md-4 px-lg-5 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                      </div>
                    </form>
                    <!-- Password Section -->
                    <!-- <div class="p-4 shadow-sm mt-4" id="password-info">
                        <div class="d-flex align-items-center mb-3 justify-content-between">
                            <h6>Password</h6>
                            <button class="text-muted edit-btn p-0 m-0 bg-transparent border-0 h-25" onclick="toggleEdit('password-info', 'password-edit', this)"><span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span></button>
                        </div>
                        <h4 class="text-secondary">.................</h4>
                    </div> -->
                    <!-- Edit Password Section -->
                    <!-- <form method="POST" class="p-4 shadow mt-4 d-none" id="password-edit">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="password">
                      <div class="d-flex align-items-center mb-3 justify-content-between">
                          <h6>Password</h6>
                      </div>
                      <label class="text-black-50" for="current_password">Current password</label>
                      <input type="password" name="current_password" required id="current_password" class="form-control mb-4 w-50" style="background-color: rgb(238	240	244);" title="Please write your current password">
                      <label class="text-black-50" for="new_password">New password</label>
                      <input type="password" name="new_password" required id="new_password" class="form-control mb-4 w-50" style="background-color: rgb(238	240	244);" title="Please enter your new password">
                      <h6 class="text-black-50" for="confirm_password">Confirm password</h6>
                      <input type="password" name="" required id="confirm_password" class="form-control w-50" style="background-color: rgb(238	240	244);" title="Please confirm your new password">
                      <small id="error_handler" class="text-danger mt-0" style="font-size: smaller;"></small>
                      <div class="d-flex align-items-center mt-4 gap-1 col-12 mx-auto">
                          <button type="button" class="btn bg-transparent px-md-4 px-lg-5 fs-6 border rounded rounded-pill border-1" onclick="toggleEdit('password-info', 'password-edit')">Cancel</button>
                          <button type="submit" id="password_change" class="btn btn-primary px-md-4 px-lg-5 fs-6 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                      </div>
                  </form> -->
                  </div>
                  <!-- mobile view -->
                  <div class="d-block d-sm-none">
                    <!-- Profile info -->
                    <div class="bg-white shadow-sm px-2 py-4 my-3" id="mobile-profile-info">
                      <div class="d-flex align-items-center mb-5 justify-content-between">
                        <h5 class="fw-medium">Profile information</h5>
                        <button class="text-muted p-0 m-0 edit-btn bg-transparent border-0 h-25" onclick="toggleEdit('mobile-profile-info', 'mobile-profile-edit', this)">
                          <div class="d-flex justify-content-end">
                            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span>
                          </div>
                        </button>
                      </div>
                      <div class="">
                        <h6 class="text-black-50 mb-2">First name</h6>
                        <h6 class="mb-3">{{user.first_name|default_if_none:""}}</h6>
                        <h6 class="text-black-50 mb-2">Last name</h6>
                        <h6 class="mb-3">{{user.last_name|default_if_none:""}}</h6>
                        <h6 class="text-black-50 mb-2">Country</h6>
                        <h6 class="mb-3">{{userinfos.country|default_if_none:""}}</h6>
                        <h6 class="text-black-50 mb-2">Mobile number</h6>
                        <h6 class="mb-3">{{userinfos.phonenum|default_if_none:""}}</h6>
                      </div>
                    </div>
                    <!-- edit profile info -->
                    <form method="POST" class="bg-white shadow d-none px-3 py-4 my-3" id="mobile-profile-edit">
                        {% csrf_token %}
                        <h5 class="fw-medium mb-5">Profile information</h5>
                        <input type="hidden" name="form_type" value="profile_information">
                    <div class="">
                      <label for="first_name" class="text-black-50">First name</label>
                      <input type="text" value="{{user.first_name|default_if_none:""}}" name="first_name" id="first_name" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <label for="last_name" class="text-black-50">Last name</label>
                      <input type="text" value="{{user.last_name|default_if_none:""}}" name="last_name" id="last_name" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <label for="country" class="text-black-50">Country</label>
                      <input type="text" value="{{userinfos.country|default_if_none:""}}" name="country" id="country" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <label for="phonenum" class="text-black-50">Mobile number</label>
                      <input type="text" value="{{userinfos.phonenum|default_if_none:""}}" name="phonenum" id="phonenum" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                    </div>
                    <div class="d-flex align-items-center gap-1 col-12 mx-auto">
                        <button type="button" class="btn bg-transparent px-4 fs-6 border rounded rounded-pill border-1" onclick="toggleEdit('mobile-profile-info', 'mobile-profile-edit')">Cancel</button>
                        <button type="submit" class="btn btn-primary px-4 fs-6 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                    </div>
                    </form>
                    <!-- Email info -->
                    <div class="bg-white shadow-sm px-2 py-5 mb-3" id="mobile-email-info">
                      <div class="d-flex align-items-center justify-content-between">
                        <h5 class="fw-medium text-muted">Email</h5>
                        <button class="text-muted edit-btn p-0 m-0 bg-transparent border-0 h-25" onclick="toggleEdit('mobile-email-info', 'mobile-email-edit', this)">
                          <div class="d-flex justify-content-end">
                            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span>
                          </div>
                        </button>
                      </div>
                      <a href="mailto:user@gmail.com" class="fs-6 mt-1 text-secondary">{{user.email|default_if_none:""}}</a>
                    </div>
                    <!-- edit email info -->
                    <form method="POST" class="bg-white shadow-sm d-none px-3 py-5 mb-3" id="mobile-email-edit">
                      {% csrf_token %}
                        <h5 class="fw-medium text-muted">Email</h5>
                      <input type="hidden" name="form_type" value="email">
                      <input type="email" name="email" value="{{user.email|default_if_none:""}}" id="email" class="form-control w-75" style="background-color: rgb(238	240	244);">
                      <div class="d-flex align-items-center mt-4 gap-1 col-12 mx-auto">
                        <button type="button" class="btn bg-transparent px-4 fs-6 border rounded rounded-pill border-1" onclick="toggleEdit('mobile-email-info', 'mobile-email-edit')">Cancel</button>
                        <button type="submit" class="btn btn-primary px-4 fs-6 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                    </div>
                    </form>
                    <!-- Password info -->
                    <!-- <div class="bg-white shadow-sm px-2 py-5 mb-3" id="mobile-password-info">
                      <div class="d-flex align-items-center justify-content-between">
                        <h5 class="fw-medium text-muted">Password</h5>
                        <button class="text-muted p-0 m-0 edit-btn bg-transparent border-0 h-25" onclick="toggleEdit('mobile-password-info', 'mobile-password-edit', this)">
                          <div class="d-flex justify-content-end">
                            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">edit</span>
                          </div>
                        </button>
                      </div>
                      <h3 class="fw-bold">................</h3>
                    </div> -->
                    <!-- edit password info -->
                    <!-- <form method="POST" class="bg-white d-none shadow px-3 py-5 mb-3" id="mobile-password-edit">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="password">
                      <h5 class="fw-medium text-muted">Password</h5>
                      <h6 class="text-black-50 mt-4">Current password</h6>
                      <input type="text" name="" id="" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <h6 class="text-black-50 mt-4">New password</h6>
                      <input type="text" name="" id="" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <h6 class="text-black-50 mt-4">Confirm password</h6>
                      <input type="text" name="" id="" class="form-control mb-4 w-75" style="background-color: rgb(238	240	244);">
                      <div class="d-flex align-items-center gap-1 col-12 mx-auto">
                          <button type="button" class="btn bg-transparent px-4 fs-6 border rounded rounded-pill border-1" onclick="toggleEdit('mobile-password-info', 'mobile-password-edit')">Cancel</button>
                          <button type="submit" id="password_change" class="btn btn-primary px-4 fs-6 border rounded rounded-pill border-1" style="background-color: rgb(59, 5, 251);">Save</button>
                      </div>
                    </form> -->

                  </div>
                </div>
                <!-- Wallet -->
                <div class="tab-pane fade col-12 col-md-11 mb-5" id="v-pills-wallet" role="tabpanel" aria-labelledby="wallet-tab" tabindex="0">
                    <h5 class="ms-3 d-none d-sm-block">Wallet</h5>
                    <div class="bg-white shadow-sm rounded rounded-1 col-12 px-0 px-sm-3 py-4">
                        <!-- <div class="d-block d-sm-flex align-items-center justify-content-between col-12">
                            <div class="">
                                <h6 class="text-secondary text-center">Wallet balance</h6>
                                <h3 class="text-center">0$</h3>
                            </div>
                            <button class="btn btn-primary rounded-pill d-flex d-sm-block mx-auto mx-sm-0" style="background-color: rgb(59	5	251);">+ Top up balance</button>
                        </div>
                        <hr class="mx-0 mb-0 mt-4 fw-bold bg-secondary" style="color: rgb(204, 204, 204);" size="4px"> -->
                        <div class=" col-11 m-auto mt-3">
                            {% for card in payment_methods %}
                            <!-- cards -->
                            <div class="shadow-sm d-flex align-items-center mb-3 rounded rounded-2 justify-content-between ps-1 pe-3 px-sm-3 pt-3 pb-1">
                                <div class="card border-0 mb-3 col-10" style="max-width: 243px;z-index: 1;">
                                    <div class="d-flex align-items-center">
                                        <div class="col-3 d-flex align-items-center justify-content-center">
                                            {% if card.card_type|lower == "mastercard" %}
                                                <img src="https://img.icons8.com/?size=65&id=pNfxhf2SghvK&format=png&color=000000" alt="">
                                            {% elif card.card_type|lower == "amex" %}
                                                <img src="https://img.icons8.com/?size=65&id=HNTWDEyM2bxs&format=png&color=000000" alt="">
                                            {% else %}
                                                <img src="https://img.icons8.com/?size=65&id=OIF51EoB6cRJ&format=png&color=000000" alt="">
                                            {% endif %}
                                        </div>
                                      <div class="col-12">
                                        <div class="card-body pe-0 ps-1 ps-sm-3 ps-md-4 py-0">
                                          <h6 class="card-title" style="font-size:13px;">{{card.card_holder_name}}...{{card.last4}}</h6>
                                          <p class="card-text text-black-50 m-0" style="font-size: x-small;">Expires {{card.exp_month}}/{{card.exp_year}}</p>
                                          <p class="card-text text-black-50 m-0" style="font-size: x-small;">Added on {{card.created_at|date:"Y-m-d"}}</p>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <a href="{% url 'payment_method_delete' card.id 'brands_account' %}" class="text-decoration-none" style="z-index: 2;"><span class="material-symbols-outlined text-danger" style="font-variation-settings: 'FILL' 1;">delete</span></a>  
                            </div>  
                            {% endfor %}
                            <div class="btn btn-transparent px-4 mt-3" style="border-color: rgb(59, 5, 251);color:rgb(59, 5, 251)" data-bs-toggle="modal" data-bs-target="#addnewcard">Add new card</div>
                        </div>
                    </div>
                </div>
                <!-- Orders -->
                <div class="tab-pane fade col-12 col-md-10 col-lg-9 col-xl-8 mb-5" id="v-pills-orders" role="tabpanel" aria-labelledby="orders-tab" tabindex="0">
                  <h5 class="ms-5 mb-4 d-none d-sm-block">Orders history</h5>
                  
                  <div class="bg-white shadow-sm rounded rounded-1 col-12 px-2 px-sm-3 px-lg-3 py-1">
                    {% for order in orders %}
                        <div class="d-flex align-items-center col-10 col-sm-11 mx-auto mb-3 mt-2 justify-content-between">
                          <div class="">
                            <h6>Order #{{order.id}} <span class="text-black-50 ms-4 d-none d-sm-inline">{{order.created_at|date:"Y/m/d"}}</span></h6>
                            <h6 class="text-black-50 mt-4">{{order.total_price}}$ <span class="text-black-50 ms-2 d-inline d-sm-none">{{order.created_at|date:"Y/m/d"}}</span></h6>
                          </div>
                          <button class="fs-6 btn p-0 text-decoration-underline border-0" data-bs-toggle="modal" data-bs-target="#order{{order.id}}" style="color: rgb(54	8	251);">Details</button>
                        </div>
                        <!-- order modal -->
                        <div class="modal fade" tabindex="-1" id="order{{order.id}}" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content m-auto border-0" style="max-width: 500px;">
                              <div class="modal-header pb-2 border-bottom-0">
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body px-0 pb-3 p-sm-4">
                                <div class="card px-3 px-sm-0 border-0 p-0 m-0" style="max-width: 540px;">
                                  <div class="d-flex align-items-stretch gap-sm-1 g-0">
                                    <div class="col-6 col-sm-5">
                                      <img src="{{order.product_img.url}}" class="img-fluid rounded w-100 h-100 overflow-hidden" style="object-fit:cover;" alt="...">
                                    </div>
                                    <div class="col-6 col-sm-7">
                                      <div class="col ps-2 pe-0 d-flex flex-column h-100 justify-content-between card-body py-0">
                                        <div class="row">
                                          <h6 class="text-black-50 mb-0 mb-sm-2">Brand</h6>
                                          <h6 class="">{{order.company.company_name}}</h6>
                                        </div>
                                        <div class="row">
                                          <h6 class="text-black-50 mb-0 mb-sm-2">Product</h6>
                                          <h6 class="">{{order.product_name}}</h6>
                                        </div>
                                        <div class="row mb-3">
                                        <a href="https://{{order.product_link}}" class="text-decoration-none gap-1 d-flex align-items-center text-black-50 fs-6">Product link<span class="material-symbols-outlined" style="color: rgb(59	5	251);">arrow_outward</span></a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <hr class="text-secondary fw-bold bg-secondary" size="4px">
                                <div class="row d-flex gap-4 gap-sm-0 col-12 px-sm-0 ps-3 m-0">
                                  <div class="col col-6 col-sm-5">
                                    <div class="row fs-5 text-secondary">Video duration</div>
                                    <div class="row my-3 fs-5 text-secondary">Content format</div>
                                    <div class="row fs-5 text-secondary">Content type</div>
                                  </div>
                                  <div class="col col-4 col-sm-7">
                                    <div class="row fs-5">{{order.video_duration}} sec.</div>
                                    <div class="row my-3 fs-5">{{order.video_size}}</div>
                                    <div class="row fs-5">{{order.video_type}}</div>
                                  </div>
                                </div>
                                {% if order.additional_notes != "" %}
                                    <hr class="text-secondary fw-bold bg-secondary" size="4px">
                                    <div class="ps-3 px-sm-0">
                                      <h5 class="text-secondary">Unique selling point</h5>
                                      <p class="fs-6">{{order.additional_notes}}</p>
                                    </div>                                  
                                {% endif %}
                                <hr class="text-secondary fw-bold bg-secondary" size="4px">
                                <div class="row d-flex px-sm-0 ps-3 m-0">
                                  <div class="col col-8 col-sm-5">
                                    <div class="row fs-5 text-secondary">Number of videos</div>
                                    <div class="row fs-5 text-secondary">Total</div>
                                  </div>
                                  <div class="col col-4 col-sm-7">
                                    <div class="row fs-5">{{order.num_of_videos}}</div>
                                    <div class="row fs-5">${{order.total_price|floatformat:.0}}</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <hr class="m-0 text-secondary fw-bold bg-secondary" size="4px">                      
                    {% endfor %}
                  </div>
                </div>
            </div>
        </div>
    </div>

  <!-- Modal -->
<div class="modal fade" id="addnewcard" tabindex="-1" aria-labelledby="addnewcardLabel" aria-hidden="true" dir="ltr">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0 d-flex justify-content-between">
            <h1 class="modal-title fs-5 fw-bold" id="addnewcardLabel">Add a new card</h1>
            <div class="d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="margin-left: 4px;" width="28.5" height="28.5" viewBox="0 0 256 256" xml:space="preserve">
                    <defs>
                    </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 84.259 16.068 H 5.741 C 2.57 16.068 0 18.638 0 21.809 v 6.131 v 2 V 60.06 v 2 v 6.131 c 0 3.171 2.57 5.741 5.741 5.741 h 78.518 c 3.171 0 5.741 -2.57 5.741 -5.741 V 62.06 v -2 V 29.94 v -2 v -6.131 C 90 18.638 87.43 16.068 84.259 16.068 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(240,240,240); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 4 68.191 V 62.06 v -2 V 29.94 v -2 v -6.131 c 0 -3.171 2.57 -5.741 5.741 -5.741 h -4 C 2.57 16.068 0 18.638 0 21.809 v 6.131 V 62.06 v 6.131 c 0 3.171 2.57 5.741 5.741 5.741 h 4 C 6.57 73.932 4 71.362 4 68.191 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgba(212, 212, 212, 0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 23.425 34.639 c -0.797 0.943 -2.072 1.687 -3.347 1.581 c -0.159 -1.275 0.465 -2.63 1.195 -3.467 c 0.797 -0.97 2.192 -1.66 3.321 -1.713 C 24.727 32.368 24.209 33.67 23.425 34.639 M 24.58 36.472 c -1.846 -0.106 -3.427 1.049 -4.304 1.049 c -0.89 0 -2.232 -0.996 -3.693 -0.97 c -1.899 0.027 -3.666 1.102 -4.636 2.816 c -1.992 3.427 -0.518 8.501 1.408 11.29 c 0.943 1.381 2.072 2.896 3.56 2.843 c 1.408 -0.053 1.966 -0.917 3.666 -0.917 c 1.713 0 2.205 0.917 3.693 0.89 c 1.541 -0.027 2.51 -1.381 3.454 -2.763 c 1.076 -1.567 1.514 -3.095 1.541 -3.175 c -0.027 -0.027 -2.975 -1.156 -3.002 -4.556 c -0.027 -2.843 2.324 -4.197 2.431 -4.277 C 27.37 36.738 25.298 36.526 24.58 36.472 M 35.247 32.62 v 20.708 h 3.214 v -7.08 h 4.45 c 4.065 0 6.92 -2.789 6.92 -6.827 s -2.803 -6.801 -6.814 -6.801 L 35.247 32.62 L 35.247 32.62 z M 38.461 35.33 h 3.706 c 2.789 0 4.383 1.488 4.383 4.104 c 0 2.617 -1.594 4.118 -4.397 4.118 h -3.693 V 35.33 z M 55.702 53.488 c 2.019 0 3.892 -1.023 4.742 -2.643 h 0.066 v 2.484 h 2.975 V 43.021 c 0 -2.989 -2.391 -4.915 -6.07 -4.915 c -3.414 0 -5.937 1.953 -6.03 4.636 h 2.896 c 0.239 -1.275 1.421 -2.112 3.042 -2.112 c 1.966 0 3.068 0.917 3.068 2.603 v 1.142 l -4.011 0.239 c -3.732 0.226 -5.751 1.753 -5.751 4.41 C 50.628 51.708 52.713 53.488 55.702 53.488 z M 56.565 51.03 c -1.713 0 -2.803 -0.824 -2.803 -2.085 c 0 -1.302 1.049 -2.059 3.055 -2.178 l 3.573 -0.226 v 1.169 C 60.391 49.649 58.744 51.03 56.565 51.03 z M 67.457 58.96 c 3.135 0 4.609 -1.195 5.898 -4.822 L 79 38.305 h -3.268 l -3.786 12.233 H 71.88 l -3.786 -12.233 h -3.361 l 5.446 15.076 l -0.292 0.917 c -0.491 1.554 -1.288 2.152 -2.71 2.152 c -0.252 0 -0.744 -0.027 -0.943 -0.053 v 2.484 C 66.421 58.934 67.218 58.96 67.457 58.96 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(51,51,51); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" style="margin-left: 4px;" width="28.5" height="28.5" viewBox="0 0 256 256" xml:space="preserve">
                      <defs>
                      </defs>
                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                        <path d="M 84.259 16.068 H 5.741 C 2.57 16.068 0 18.638 0 21.809 v 6.131 v 2 V 60.06 v 2 v 6.131 c 0 3.171 2.57 5.741 5.741 5.741 h 78.518 c 3.171 0 5.741 -2.57 5.741 -5.741 V 62.06 v -2 V 29.94 v -2 v -6.131 C 90 18.638 87.43 16.068 84.259 16.068 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(240,240,240); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 4 68.191 V 62.06 v -2 V 29.94 v -2 v -6.131 c 0 -3.171 2.57 -5.741 5.741 -5.741 h -4 C 2.57 16.068 0 18.638 0 21.809 v 6.131 V 62.06 v 6.131 c 0 3.171 2.57 5.741 5.741 5.741 h 4 C 6.57 73.932 4 71.362 4 68.191 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgba(212, 212, 212, 0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 43.141 44.662 v 7.903 h -2.549 V 33.021 h 6.628 c 1.614 0 3.144 0.595 4.334 1.699 c 1.19 1.02 1.784 2.549 1.784 4.164 s -0.595 3.059 -1.784 4.164 c -1.19 1.105 -2.634 1.699 -4.334 1.699 L 43.141 44.662 L 43.141 44.662 z M 43.141 35.4 v 6.798 h 4.249 c 0.935 0 1.869 -0.34 2.464 -1.02 c 1.36 -1.275 1.36 -3.399 0.085 -4.674 l -0.085 -0.085 c -0.68 -0.68 -1.53 -1.105 -2.464 -1.02 H 43.141 L 43.141 35.4 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(95,99,104); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 59.201 38.799 c 1.869 0 3.314 0.51 4.419 1.53 s 1.614 2.379 1.614 4.079 v 8.157 h -2.379 v -1.869 H 62.77 c -1.02 1.53 -2.464 2.294 -4.164 2.294 c -1.445 0 -2.719 -0.425 -3.739 -1.275 c -0.935 -0.85 -1.53 -2.039 -1.53 -3.314 c 0 -1.36 0.51 -2.464 1.53 -3.314 c 1.02 -0.85 2.464 -1.19 4.164 -1.19 c 1.53 0 2.719 0.255 3.654 0.85 v -0.595 c 0 -0.85 -0.34 -1.699 -1.02 -2.209 c -0.68 -0.595 -1.53 -0.935 -2.464 -0.935 c -1.445 0 -2.549 0.595 -3.314 1.784 l -2.209 -1.36 C 55.037 39.649 56.822 38.799 59.201 38.799 z M 55.972 48.486 c 0 0.68 0.34 1.275 0.85 1.614 c 0.595 0.425 1.275 0.68 1.954 0.68 c 1.02 0 2.039 -0.425 2.804 -1.19 c 0.85 -0.765 1.275 -1.699 1.275 -2.719 c -0.765 -0.595 -1.869 -0.935 -3.314 -0.935 c -1.02 0 -1.869 0.255 -2.549 0.765 C 56.312 47.127 55.972 47.721 55.972 48.486 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(95,99,104); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 79 39.224 l -8.412 19.289 h -2.549 l 3.144 -6.713 l -5.523 -12.491 h 2.719 l 3.994 9.602 h 0.085 l 3.909 -9.602 H 79 V 39.224 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(95,99,104); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 33.029 42.963 c 0 -0.765 -0.085 -1.53 -0.17 -2.294 H 22.238 v 4.334 h 6.033 c -0.255 1.36 -1.02 2.634 -2.209 3.399 v 2.804 h 3.654 C 31.84 49.251 33.029 46.362 33.029 42.963 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(66,133,244); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 22.238 53.924 c 3.059 0 5.608 -1.02 7.478 -2.719 l -3.654 -2.804 c -1.02 0.68 -2.294 1.105 -3.824 1.105 c -2.889 0 -5.438 -1.954 -6.288 -4.674 h -3.739 v 2.889 C 14.165 51.545 17.989 53.924 22.238 53.924 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(52,168,83); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 15.95 44.832 c -0.51 -1.36 -0.51 -2.889 0 -4.334 V 37.61 h -3.739 c -1.614 3.144 -1.614 6.883 0 10.112 L 15.95 44.832 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(251,188,4); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                        <path d="M 22.238 35.91 c 1.614 0 3.144 0.595 4.334 1.699 l 0 0 l 3.229 -3.229 c -2.039 -1.869 -4.759 -2.974 -7.478 -2.889 c -4.249 0 -8.157 2.379 -10.027 6.203 l 3.739 2.889 C 16.799 37.865 19.349 35.91 22.238 35.91 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(234,67,53); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                    </g>
                    </svg>
                <img src="https://img.icons8.com/?size=30&id=OIF51EoB6cRJ&format=png&color=000000" alt="">
                <img src="https://img.icons8.com/?size=30&id=pNfxhf2SghvK&format=png&color=000000" alt="">
                <img src="https://img.icons8.com/?size=30&id=HNTWDEyM2bxs&format=png&color=000000" alt="">
            </div>
</div>
        <div class="modal-body">
        <form id="payment-method-form" method="post">
            {% csrf_token %}
            <div class="form-floating mb-3">
              <input type="hidden" name="form_type" value="add_card">
              <input type="text" class="form-control" id="card-holder-name" placeholder="name@example.com" name="card_holder_name" required>
              <label for="card-holder-name" class="text-muted">Card Holder's Name</label>
            </div>
          <div id="card-element" class="border border-secondary-subtle p-3 rounded"></div>
          </div>
          <div class="modal-footer border-0">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn text-light" style="background-color: #4A0EFB;">Save Card</button>
  
          </div>
      </form>
      </div>
    </div>
  </div>
  

<script>
    // Get the confirm password button
    const confirmPasswordButton = document.getElementById("password_change");
    const error_handler = document.getElementById("error_handler")
    const newPasswordInput = document.getElementById('new_password');

    // Add an event listener to the confirm password button
    confirmPasswordButton.addEventListener('click', (e) => {
        // Prevent the default behavior of the button
        e.preventDefault();

        // Get the new password and confirm password inputs
        const confirmPasswordInput = document.getElementById('confirm_password');

        // Get the values of the new password and confirm password inputs
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Check if the new password and confirm password match
        if (newPassword !== confirmPassword) {
            // Display an error message if the passwords do not match
            error_handler.innerText = "the password field don't match";
        } else {
            // Check if the new password meets the security requirements
            if (!validatePassword(newPassword)) {
                error_handler.innerText = 'password has to be at least 8 chracters and has to containt a number,\n a special character and a capitalized/small letter!!';
            } else {
                // Submit the form if the passwords match and meet the security requirements
                document.querySelector('#password_form').submit();
                error_handler.innerText = '';
            }
        }
    });

    // Function to validate the password
    function validatePassword(password) {
        // Check if the password is at least 8 characters long
        if (password.length < 8) {
            return false;
        }

        // Check if the password contains at least one uppercase letter
        if (!/[A-Z]/.test(password)) {
            return false;
        }

        // Check if the password contains at least one lowercase letter
        if (!/[a-z]/.test(password)) {
            return false;
        }

        // Check if the password contains at least one number
        if (!/\d/.test(password)) {
            return false;
        }

        // Check if the password contains at least one symbol
        if (!/[^A-Za-z0-9]/.test(password)) {
            return false;
        }

        // If all checks pass, the password is valid
        return true;
    }
</script>

<!-- stripe script -->
<script>
    var stripe = Stripe('{{ stripe_publishable_key }}');
    var stripe_elements = stripe.elements();
    var card = stripe_elements.create('card');
    card.mount('#card-element');
  
    var form = document.getElementById('payment-method-form');
    form.addEventListener('submit', function(event) {
        event.preventDefault();
  
        stripe.createToken(card, {
            name: document.getElementById('card-holder-name').value
        }).then(function(result) {
            if (result.error) {
                console.log(result.error.message);
            } else {
                var hiddenInput = document.createElement('input');
                hiddenInput.setAttribute('type', 'hidden');
                hiddenInput.setAttribute('name', 'stripeToken');
                hiddenInput.setAttribute('value', result.token.id);
                form.appendChild(hiddenInput);
                form.submit();
            }
        });
    });
</script>
 
<script>
    document.addEventListener('DOMContentLoaded', function() {
      var errorModal = document.getElementById('errorModal');
      errorModal.classList.add('show');
      errorModal.style.display = 'block';
    });
    
    document.getElementById('btn-closee').addEventListener('click', function(event) {
      var errorModal = document.getElementById('errorModal');
      errorModal.classList.remove('show');
      errorModal.style.display = 'none';    
    });

    // Get the form element
var form = document.getElementById('payment-method-form');

// Add an event listener to the form submission
form.addEventListener('submit', function(event) {
    // Prevent the default form submission behavior
    event.preventDefault();

    // Create a Stripe token
    stripe.createToken(card).then(function(result) {
        if (result.error) {
            // Handle Stripe errors
            handleStripeError(result.error);
        } else {
            // Add the token to the form.
            var hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripeToken');
            hiddenInput.setAttribute('value', result.token.id);
            form.appendChild(hiddenInput);

            // Add the card holder name to the form.
            var cardHolderNameInput = document.createElement('input');
            cardHolderNameInput.setAttribute('type', 'hidden');
            cardHolderNameInput.setAttribute('name', 'card_holder_name');
            cardHolderNameInput.setAttribute('value', document.getElementById('card-holder-name').value);
            form.appendChild(cardHolderNameInput);

            // Submit the form.
            form.submit();
        }
    });
});

// Function to handle Stripe errors
function handleStripeError(error) {
    // Check the error type and display a message accordingly
    switch (error.code) {
        case 'card_declined':
            displayErrorMessage('The card was declined.');
            break;
        case 'incorrect_number':
            displayErrorMessage('The card number is incorrect.');
            break;
        case 'invalid_number':
            displayErrorMessage('The card number is invalid.');
            break;
        case 'invalid_expiry_month':
            displayErrorMessage('The expiration month is invalid.');
            break;
        case 'invalid_expiry_year':
            displayErrorMessage('The expiration year is invalid.');
            break;
        case 'invalid_cvc':
            displayErrorMessage('The CVC is invalid.');
            break;
        case 'expired_card':
            displayErrorMessage('The card has expired.');
            break;
        case 'incorrect_cvc':
            displayErrorMessage('The CVC is incorrect.');
            break;
        case 'incorrect_zip':
            displayErrorMessage('The zip code is incorrect.');
            break;
        default:
            displayErrorMessage('An unknown error occurred.');
    }
}

// Function to display an error message
function displayErrorMessage(message) {
    // You can customize this function to display the error message in your UI
    console.log(message);
    // For example, you can display the error message in a div element
    var errorElement = document.getElementById('error-message');
  //  errorElement.textContent = message;
}

</script>

{% endblock %}